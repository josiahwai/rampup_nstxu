function circ = nstxu2016_circ(tok_data_struct)

% Defines the following circuit connection information for NSTXU
%
% __circ := circuit connection vector
% __frac := fraction of the circuit current carried by that coil. Coils are
%           connected in series, so ccfrac is proportional to # of loops.
%           Vessel elements are connected in parallel, so vvfrac is related
%           through the vessel resistances (1/R_tot = sum(1/R_i))

% Circuit connection vectors
cccirc = [1 2 3 4 5 5 6 6 6 6 7 7 7 7 7 7 8 8 8 8 9 9 9 9 10 10 11 12 13];

fccirc = cccirc(2:end)' - 1;

vvcirc = [1  1  2  2  3  4  5  5  5  6  6  6  6  6  6  6  6  6  6  6 ...
     6  6  6  6  7  7  7  7  7  8  8  8  8  9  9  9  9  9  9  9  9  9 ...
     9  9  9  9  9  9  9  9  9  9  9  9  9  9  9 10 10 10 11 11 11 11 ...
    11 12 12 13 13 13 14 15 16 17 18 18 18 19 19 20 20 20 20 20 21 21 ...
    21 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 ...
    22 22 22 23 23 23 23 24 24 24 24 24 25 25 25 25 25 25 25 25 25 25 ...
    25 25 25 25 25 26 26 26 27 28 29 29 30 30 31 31 32 32 33 34 35 36 ...
    37 38 39 40];

% Current fraction vectors
% f-coils serial connection, current fraction propto # of turns
fcnturn = tok_data_struct.fcnturn(:)';
fcfrac = zeros(size(fcnturn));
for icirc = 1:max(fccirc)
  icoils = find(fccirc == icirc);
  fcfrac(icoils) = fcnturn(icoils) / sum(fcnturn(icoils));  
end

ccfrac = [1 fcfrac];

% vessel parallel connection, current fraction related to resistance
resv = tok_data_struct.resv;
vvfrac = zeros(size(vvcirc));
for icirc = 1:max(vvcirc)
  icond = find(vvcirc == icirc);
  sum_rinv = sum(1./resv(icond));
  vvfrac(icond) = 1./resv(icond)/sum_rinv;
end

vvnames = char({  ...
    'VS1U',   ...
    'VS2U',   ...
    'VS3U',   ...
    'VS4U',   ...
    'VS5U',   ...
    'VS6U',   ...
    'VS7U',   ...
    'VS8U',   ...
    'VS9U',   ...
    'VS10U',  ...
    'VS11U',  ...
    'VS12U',  ...
    'VS13U',  ...
    'VS14U',  ...
    'VS15U',  ...
    'VS15L',  ...
    'VS14L',  ...
    'VS13L',  ...
    'VS12L',  ...
    'VS11L',  ...
    'VS10L',  ...
    'VS9L',   ...
    'VS8L',   ...
    'VS7L',   ...
    'VS6L',   ...
    'VS5L',   ...
    'VS4L',   ...
    'VS3L',   ...
    'VS2L',   ...
    'VS1L',   ...
    'DPU1',   ...
    'DPL1',   ...
    'PPSIUU', ...
    'PPSIUL', ...
    'PPPOUU', ...
    'PPPOUL', ...
    'PPPOLU', ...
    'PPPOLL', ...
    'PPSILL', ...
    'PPSILU'
});


circ = struct('cccirc', cccirc, 'fccirc', fccirc', 'vvcirc', vvcirc, ...
  'ccfrac', ccfrac, 'fcfrac', fcfrac, 'vvfrac', vvfrac, 'vvnames', vvnames);









































